<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Grade de Hor√°rios</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Sidebar de Professores -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>üë®‚Äçüè´ Professores</h2>
            <p>Clique para detalhes | Arraste para a grade</p>
        </div>

        <div class="sidebar-controls">
            <input type="text" class="search-box" id="searchTeacher" placeholder="üîç Buscar professor...">
            <button class="btn btn-primary" style="width: 100%;">‚ûï Cadastrar Novo Professor</button>
            <button class="btn btn-secondary" style="width: 100%; margin-top: 8px;">üìö Itiner√°rios Formativos</button>
            <button class="btn btn-warning" id="btnRestrictions" style="width: 100%; margin-top: 8px;">üö´ Restri√ß√µes de
                Hor√°rio</button>
            <button class="btn btn-success" id="btnGapsReport" style="width: 100%; margin-top: 8px;">üìä Relat√≥rio de Lacunas</button>
            <button class="btn btn-info" id="btnConfigTimeSlots" style="width: 100%; margin-top: 8px;">‚è∞ Configurar
                Hor√°rios</button>
            <button class="btn btn-danger" id="btnDeleteAllTeachers" style="width: 100%; margin-top: 8px;">
                üóëÔ∏è Excluir Todos os Professores
            </button>
        </div>

        <div class="teachers-container">
            <h3>üìã Lista <span class="teacher-count" id="teacherCount">0</span></h3>
            <div id="teachersList"></div>
        </div>
    </div>

    <!-- Container Principal -->
    <div class="main-container">
        <div class="container">
            <!-- P√ÅGINA DA GRADE -->
            <div id="schedulePage" class="page active">
                <div class="header">
                    <h1>üéì Sistema de Grade de Hor√°rios</h1>
                    <p>Escola de Ensino M√©dio - Turno Integral (7h30 - 16h30)</p>
                </div>

                <div class="stats-bar">
                    <div class="stat-item">üìö <strong id="totalLessons">0</strong> aulas atribu√≠das</div>
                    <div class="stat-item">üë• <strong id="totalTeachers">0</strong> professores</div>
                    <div class="stat-item">‚ö†Ô∏è <strong id="totalConflicts">0</strong> conflitos</div>
                </div>

                <div class="conflict-indicator" id="conflictIndicator">
                    <span class="icon">‚ö†Ô∏è</span>
                    <span class="text">Existem conflitos de hor√°rio! Verifique os cards em vermelho.</span>
                </div>

                <!-- ‚úÖ NOVOS CONTROLES DE VISUALIZA√á√ÉO -->
                <div class="controls">
                    <!-- Bot√£o de Toggle de Modo -->
                    <button class="btn btn-info" id="btnToggleView" style="font-weight: bold; padding: 12px 20px;">
                        üìÖ Modo: Geral
                    </button>

                    <!-- Seletor de Turma (vis√≠vel apenas no modo turma) -->
                    <div id="classSelector" style="display: none; align-items: center; gap: 10px; 
                                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                                    padding: 10px 15px; border-radius: 10px; color: white;">
                        <label style="font-weight: bold; margin: 0;">üè´ Turma:</label>
                        <select id="classSelectorDropdown" style="padding: 8px 12px; border-radius: 6px; border: none; 
                                       font-size: 14px; font-weight: bold; min-width: 100px;">
                        </select>
                    </div>

                    <button class="btn btn-info" id="btnShowReport">üìä Relat√≥rio de Professores</button>
                    <button class="btn btn-success" id="btnExport">üíæ Exportar JSON</button>
                    <button class="btn btn-warning" id="btnImport">üìÇ Importar JSON</button>
                    <button class="btn btn-primary" id="btnDownloadModel">üìÑ Modelo JSON</button>
                    <button class="btn btn-primary" id="btnDownloadExample">üìã Exemplo Completo</button>
                    <button class="btn btn-info" id="btnCloudSyncNow">‚òÅÔ∏è Sincronizar Agora</button>

                    <div
                        style="display: inline-flex; align-items: center; gap: 5px; margin: 0 5px; background: rgba(255,255,255,0.5); padding: 5px 10px; border-radius: 5px; border: 1px solid #ddd;">
                        <input type="checkbox" id="chkMorningOnly" style="cursor: pointer; width: 16px; height: 16px;">
                        <label for="chkMorningOnly"
                            style="cursor: pointer; font-size: 13px; font-weight: bold; color: #333;">‚òÄÔ∏è Apenas
                            Manh√£</label>
                    </div>

                    <button class="btn btn-primary" id="btnPrint">üñ®Ô∏è Imprimir</button>
                    <button class="btn btn-secondary" id="btnClassSchedule">üìÖ Hor√°rio por Turma</button>
                    <button class="btn btn-success" id="btnAutoSchedule"
                        style="font-weight: bold; padding: 12px 20px; font-size: 14px;">
                        ü§ñ Distribui√ß√£o Autom√°tica
                    </button>
                    <button class="btn btn-danger" id="btnClear">üóëÔ∏è Limpar Grade</button>
                </div>

                <!-- Tabs de Dias (vis√≠vel apenas no modo geral) -->
                <div class="tabs">
                    <button class="tab active" data-day="segunda">Segunda-feira</button>
                    <button class="tab" data-day="terca">Ter√ßa-feira</button>
                    <button class="tab" data-day="quarta">Quarta-feira</button>
                    <button class="tab" data-day="quinta">Quinta-feira</button>
                    <button class="tab" data-day="sexta">Sexta-feira</button>
                </div>

                <div class="schedule-container">
                    <div id="schedule-content"></div>
                </div>
            </div>

            <!-- P√ÅGINA DE RELAT√ìRIO -->
            <div id="reportPage" class="page">
                <div class="report-header">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                        <h1>üìä Relat√≥rio de Professores</h1>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-success" id="btnGeneratePDF" style="padding: 12px 20px;">
                                üìÑ Gerar PDF Completo
                            </button>
                            <button class="btn btn-primary" id="btnBackToSchedule">
                                ‚Üê Voltar para Grade
                            </button>
                        </div>
                    </div>
                </div>

                <div class="report-summary" id="reportSummary"></div>

                <div class="report-filters">
                    <div class="filter-group">
                        <label>Filtrar por disciplina:</label>
                        <select id="filterSubject">
                            <option value="">Todas</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Ordenar por:</label>
                        <select id="sortReport">
                            <option value="name">Nome</option>
                            <option value="lessons">Carga Hor√°ria Total</option>
                            <option value="subject">Disciplina</option>
                        </select>
                    </div>
                </div>

                <div class="report-content">
                    <div class="report-grid" id="reportGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Subject Selector -->
    <div id="subjectSelector" class="subject-selector"></div>

    <!-- Modal Cadastro Professor - COM M√öLTIPLAS CONFIGURA√á√ïES -->
    <div id="teacherModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="teacherModalTitle">üë®‚Äçüè´ Cadastrar Professor</h2>
                <button class="modal-close" data-modal="teacherModal">√ó</button>
            </div>

            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <!-- Dados b√°sicos do professor -->
                <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
                    <div class="form-group" style="flex: 2;">
                        <label>Nome Completo:</label>
                        <input type="text" id="teacherName" placeholder="Ex: Maria Silva Santos">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Disciplina Principal:</label>
                        <select id="teacherSubject">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                </div>

                <!-- Feedback de professor existente -->
                <div id="teacherNameFeedback"></div>

                <!-- Cor do professor -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label>Cor do Professor:</label>
                    <div id="colorPicker" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;"></div>
                    <input type="hidden" id="selectedColor" value="">
                </div>

                <hr style="border: none; border-top: 2px solid #e0e0e0; margin: 20px 0;">

                <!-- T√≠tulo da se√ß√£o de configura√ß√µes -->
                <div style="margin-bottom: 15px;">
                    <h3 style="color: #667eea; margin-bottom: 10px;">üìö Configura√ß√µes de Carga Hor√°ria</h3>
                    <p style="font-size: 13px; color: #666; margin-bottom: 15px;">
                        Adicione diferentes configura√ß√µes para grupos de turmas.
                        Ex: 2 aulas/semana para 1¬∫ anos e 1 aula/semana para 2¬∫ e 3¬∫ anos.
                    </p>
                </div>

                <!-- Container das configura√ß√µes de carga hor√°ria -->
                <div id="workloadConfigsContainer"></div>

                <!-- Bot√£o para adicionar mais configura√ß√µes -->
                <button type="button" class="btn btn-secondary" id="btnAddWorkloadConfig"
                    style="width: 100%; margin-top: 10px; padding: 12px;">
                    ‚ûï Adicionar outra configura√ß√£o de carga hor√°ria
                </button>

                <!-- Preview do total de carga hor√°ria -->
                <div id="totalWorkloadPreview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                     color: white; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="font-size: 14px; opacity: 0.9;">üïê CARGA HOR√ÅRIA TOTAL SEMANAL</div>
                        <div style="font-size: 36px; font-weight: bold;" id="totalHoursDisplay">0h</div>
                    </div>
                    <div id="workloadBreakdown" style="font-size: 13px; opacity: 0.9;"></div>
                </div>
            </div>

            <div class="modal-buttons" style="margin-top: 20px;">
                <button class="btn btn-success" id="btnSaveTeacher">‚úÖ Salvar Professor</button>
                <button class="btn btn-danger" data-modal="teacherModal">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal Itiner√°rios Formativos -->
    <div id="specificSubjectsModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>üìö Itiner√°rios Formativos (Carga Hor√°ria Extra)</h2>
                <button class="modal-close" data-modal="specificSubjectsModal">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px; color: #666;">
                    Cadastre os Itiner√°rios Formativos para cada professor por turma (Aprofundamento de
                    Natureza/Humanas/Linguagens/Matem√°tica, Projeto de Vida, Eletiva, PPA, Estudo Orientado, etc.).
                </p>

                <div class="form-row"
                    style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: flex-end;">
                    <div class="form-group" style="flex: 2; min-width: 200px;">
                        <label>Professor:</label>
                        <select id="specificTeacher">
                            <option value="">Selecione o professor...</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1.5; min-width: 150px;">
                        <label>Disciplina Espec√≠fica:</label>
                        <select id="specificSubject">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1; min-width: 120px;">
                        <label>Turma:</label>
                        <select id="specificClass">
                            <option value="all">Todas as Turmas</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 0.8; min-width: 100px;">
                        <label>Aulas/Semana:</label>
                        <input type="number" id="specificHours" min="1" max="20" value="1"
                            style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button class="btn btn-success" id="btnAddSpecific">‚ûï Adicionar</button>
                    </div>
                </div>

                <!-- Resumo de carga hor√°ria -->
                <div id="teacherWorkloadSummary" style="display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                     color: white; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div>
                            <strong id="summaryTeacherName" style="font-size: 16px; color: white;"></strong>
                            <div style="font-size: 13px; opacity: 0.9; color: white;" id="summaryTeacherSubject"></div>
                        </div>
                        <div style="display: flex; gap: 20px; text-align: center; flex-wrap: wrap;">
                            <div>
                                <div style="font-size: 22px; font-weight: bold; color: white;"
                                    id="summaryPrincipalHours">0</div>
                                <div style="font-size: 10px; opacity: 0.9; color: white;">Disciplina Principal</div>
                            </div>
                            <div>
                                <div style="font-size: 22px; font-weight: bold; color: white;" id="summaryExtraHours">0
                                </div>
                                <div style="font-size: 10px; opacity: 0.9; color: white;">Extras</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 8px;">
                                <div style="font-size: 28px; font-weight: bold; color: white;" id="summaryTotalHours">0
                                </div>
                                <div style="font-size: 10px; color: white;">TOTAL SEMANAL</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="specificSubjectsList" class="specific-subjects-list">
                    <p style="text-align: center; color: #999;">Selecione um professor para ver suas disciplinas
                        espec√≠ficas</p>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" data-modal="specificSubjectsModal">‚úÖ Concluir</button>
            </div>
        </div>
    </div>

    <!-- Modal Itiner√°rios Formativos (para professor espec√≠fico) -->
    <div id="teacherItineraryModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>üìö Itiner√°rios Formativos</h2>
                <button class="modal-close" data-modal="teacherItineraryModal">√ó</button>
            </div>
            <div id="teacherItineraryContent"></div>
            <div class="modal-buttons">
                <button class="btn btn-primary" data-modal="teacherItineraryModal">‚úÖ Concluir</button>
            </div>
        </div>
    </div>

    <!-- Modal Detalhes do Professor -->
    <div id="teacherDetailModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="detailModalTitle">üìã Detalhes do Professor</h2>
                <button class="modal-close" data-modal="teacherDetailModal">√ó</button>
            </div>
            <div id="teacherDetailContent"></div>
        </div>
    </div>

    <!-- Modal Editar Professor -->
    <div id="editTeacherModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>‚úèÔ∏è Editar Professor</h2>
                <button class="modal-close" data-modal="editTeacherModal">√ó</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div id="editTeacherContent"></div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" id="btnSaveEditTeacher">‚úÖ Salvar Altera√ß√µes</button>
                <button class="btn btn-danger" data-modal="editTeacherModal">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal Editar Carga Hor√°ria -->
    <div id="editWorkloadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Editar Carga Hor√°ria</h2>
                <button class="modal-close" data-modal="editWorkloadModal">√ó</button>
            </div>
            <div id="editWorkloadContent"></div>
            <div class="modal-buttons">
                <button class="btn btn-success" id="btnSaveWorkload">‚úÖ Salvar</button>
                <button class="btn btn-danger" data-modal="editWorkloadModal">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal Restri√ß√µes de Hor√°rio -->
    <div id="restrictionsModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>üö´ Restri√ß√µes de Hor√°rio</h2>
                <button class="modal-close" data-modal="restrictionsModal">√ó</button>
            </div>
            <div id="restrictionsContent"></div>
            <div class="modal-buttons">
                <button class="btn btn-primary" data-modal="restrictionsModal">‚úÖ Concluir</button>
            </div>
        </div>
    </div>

    <!-- Modal Relat√≥rio de Lacunas -->
    <div id="gapsReportModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>üìä Relat√≥rio de Disciplinas Faltantes</h2>
                <button class="modal-close" data-modal="gapsReportModal">√ó</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div id="gapsReportContent"></div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" data-modal="gapsReportModal">‚úÖ Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal Configura√ß√£o de Hor√°rios -->
    <div id="timeSlotsModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>‚è∞ Configurar Hor√°rios das Aulas</h2>
                <button class="modal-close" data-modal="timeSlotsModal">√ó</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <p style="margin-bottom: 15px; color: #666;">
                    Configure os hor√°rios de entrada e sa√≠da de cada aula. As altera√ß√µes ser√£o salvas automaticamente.
                </p>

                <div id="timeSlotsConfigList"></div>

                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <button class="btn btn-warning" id="btnResetTimeSlots" style="width: 100%;">
                        üîÑ Restaurar Hor√°rios Padr√£o
                    </button>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" id="btnSaveTimeSlots">‚úÖ Salvar Altera√ß√µes</button>
                <button class="btn btn-danger" data-modal="timeSlotsModal">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" style="display: none;" accept=".json">

    <!-- Modal Distribui√ß√£o Autom√°tica -->
    <div id="autoScheduleModal" class="modal">
        <div class="modal-content large" style="width: 95%; max-width: 800px;">
        </div>
    </div>

    <!-- Modal Visualiza√ß√£o por Turma -->
    <div id="classScheduleModal" class="modal">
        <div class="modal-content large" style="width: 95%; max-width: 1200px;">
            <div class="modal-header">
                <h2>üìÖ Hor√°rio Semanal por Turma</h2>
                <button class="modal-close" data-modal="classScheduleModal">√ó</button>
            </div>
            <div class="modal-body">
                <div
                    style="display: flex; gap: 20px; align-items: center; margin-bottom: 20px; background: #f8f9fa; padding: 15px; border-radius: 10px;">
                    <div class="form-group" style="margin-bottom: 0; min-width: 200px;">
                        <label style="font-weight: bold; margin-bottom: 5px; display: block;">Selecione a Turma:</label>
                        <select id="classScheduleSelect"
                            style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ddd;">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div style="flex: 1;"></div>
                    <button class="btn btn-primary" id="btnPrintClassSchedule">üñ®Ô∏è Imprimir</button>
                </div>

                <div id="classScheduleContainer" style="overflow-x: auto;">
                    <div style="text-align: center; color: #666; padding: 40px;">
                        Selecione uma turma acima para visualizar o hor√°rio completo.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Biblioteca jsPDF para gera√ß√£o de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Scripts da aplica√ß√£o -->
    <script src="config.js"></script>
    <script src="teachers.js"></script>
    <script src="initial_teachers.js"></script>
    <script src="setup_restrictions.js"></script>
    <script src="setup_specific_subjects.js"></script>
    <script src="gaps_report.js"></script>
    <script src="auto_schedule.js"></script>
    <script src="main.js"></script>

</body>

</html>
